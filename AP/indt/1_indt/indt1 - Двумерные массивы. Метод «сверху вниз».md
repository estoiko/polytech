## Отчёт по лабораторной работе
> [!user]
> **Стойко Елисей Алексеевич**, *5130904/50005, вариант 11*

### <mark style="background: #D2B3FFA6;">Общая постановка задачи</mark>
**Входные данные:**
- Размер квадратной матрицы N (целое число)
- N×N целых чисел - элементы матрицы

**Выходные данные:**
- Номер строки (от 1 до N), в которой находится самая длинная серия подряд идущих равных элементов

**Основные условия:**
- Если таких строк несколько, возвращается первая встретившаяся
- Матрица хранится в динамической памяти
- Обработка исключений (некорректный ввод, ошибки памяти)

**Описание алгоритма:**
Заведём вспомогательный массив `lenCount` размер N, в котором будем хранить максимальную длинну серии из одинаковых элементов в `i-й` строке. Заполним массив `-1`, чтобы корректно обновлять максимум (в любой строке максимум точно будет >= 1). 
В цикле пройдёмся по строкам, для каждой строки заведём переменную `currentMaxSubLen`, в которой будем хранить максимальную длинну серии в данной строке. Пройдёмся по элементам строки, обновляя `currentMaxSubLen`, если элементы одинаковые. Обновим `lenCount`, сбросив счётчик `currentMaxSubLen` до `1`, если серия кончилась. 
Заполнив массив `lenCount`, пробежимся в цикле по его элементам и найдём максимальную серию всей матрицы – `maxLenCount`. Ещё одним циклом найдём номер строки содержащей maxLenCount (запишем в переменную `maxLineNum`).  Функция вернёт `maxLineNum + 1`.
<div class="page-break" style="page-break-before: always;"></div>

### <mark style="background: #D2B3FFA6;">Детальные требования и тест план</mark>

| Требование                                        | Детальные требования                                  | Данные                                     | Ожидаемый результат                   |
| ------------------------------------------------- | ----------------------------------------------------- | ------------------------------------------ | ------------------------------------- |
| **1. Корректность размера матрицы**               |                                                       |                                            |                                       |
| 1.1 Размер матрицы - целое число                  | 1.1 Если размер не число, исключение при чтении       | `a`                                        | `"ERROR: Invalid size specified"`     |
| 1.2 Размер матрицы > 0                            | 1.2 Если размер ≤ 0, исключение `invalid_argument`    | `0`                                        | `"ERROR: Invalid size specified"`     |
| **2. Корректность элементов матрицы**             |                                                       |                                            |                                       |
| 2.1 Все элементы матрицы - целые числа            | 2.1 Если элемент не число, исключение `runtime_error` | `2`<br>`1 2`<br>`3 a`                      | `"ERROR: Invalid matrix element"`     |
| 2.2 Введено ровно size×size элементов             | 2.2 Если элементов меньше, исключение `runtime_error` | `2`<br>`1 2 3 ^D`                          | `"ERROR: Not enough matrix elements"` |
| **3. Корректность работы алгоритма поиска серий** |                                                       |                                            |                                       |
| 3.1 Матрица 1×1                                   | 3.1 Длина серии всегда 1                              | `1`<br>`5`                                 | `1`                                   |
| 3.2 Все элементы в строке одинаковые              | 3.2 Длина серии равна размеру матрицы                 | `2`<br>`1 1`<br>`2 3`                      | `1`                                   |
| 3.3 Серия в начале строки                         | 3.3 Корректно определяется серия в начале             | `3`<br>`1 1 2`<br>`3 4 5`<br>`6 7 8`       | `1`                                   |
| 3.4 Серия в середине строки                       | 3.4 Корректно определяется серия в середине           | `3`<br>`1 2 2 1`<br>`3 4 5 7`<br>`6 7 8 9` | `1`                                   |
| 3.5 Серия в конце строки                          | 3.5 Корректно определяется серия в конце              | `3`<br>`1 2 3`<br>`4 5 5`<br>`6 7 8`       | `2`                                   |
| 3.6 Все строки с одинаковой максимальной серией   | 3.6 Возвращается первая встретившаяся строка          | `3`<br>`1 1 2`<br>`3 3 4`<br>`5 6 6`       | `1`                                   |
| 3.7 Все элементы разные                           | 3.7 В каждой строке серия длины 1                     | `2`<br>`1 2`<br>`3 4`                      | `1`                                   |
| **4. Особые и граничные случаи**                  |                                                       |                                            |                                       |
| 4.2 Отрицательные числа                           | 4.2 Алгоритм работает с отрицательными числами        | `2`<br>`-1 -1`<br>`2 -3`                   | `1`                                   |
| 4.3 Нули в матрице                                | 4.3 Алгоритм работает с нулями                        | `2`<br>`0 0`<br>`1 2`                      | `1`                                   |
| **5. Управление памятью**                         |                                                       |                                            |                                       |
| 5.1 Корректное выделение памяти                   | 5.1 Память выделяется без утечек                      | Любой тест                                 | Нет утечек памяти[^1]                 |
| 5.2 Корректное освобождение памяти                | 5.2 Память освобождается полностью                    | Любой тест                                 | Нет утечек памяти[^1]                 |
| 5.3 Исключение при выделении памяти               | 5.3 Обработка `bad_alloc` без утечек                  | Очень большой размер                       | `"ERROR: Memory is not allocated"`    |
<div class="page-break" style="page-break-before: always;"></div>
### <mark style="background: #D2B3FFA6;">Проверка на наличие утечек памяти</mark>
```bash
# компилируем с отладочной информацией
clang++ -g a.cpp -o a 
# ищем утечки памяти
leaks --list --atExit -- ./a
```

1. Валидный тест
```bash
2
1 1
2 3
```

```bash
1

----

leaks Report Version: 3.0
Process 7302: 188 nodes malloced for 21 KB
Process 7302: 0 leaks for 0 total leaked bytes.
```

2. Тест вызывающий исключение
```bash
2 
1 2
3
```

```bash
ERROR: Not enough matrix elements

----

leaks Report Version: 3.0
Process 8219: 189 nodes malloced for 16 KB
Process 8219: 0 leaks for 0 total leaked bytes.
```

[^1]: см. [[indt1 - Двумерные массивы. Метод «сверху вниз»#Проверка на наличие утечек памяти | Проверка на наличие утечек памяти]]
